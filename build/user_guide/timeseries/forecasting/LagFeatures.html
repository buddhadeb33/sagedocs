
<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>LagFeatures &#8212; 3.1</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css?v=4e10d9e0" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css?v=4e10d9e0" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=e1ce3931"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script defer data-domain="feature-engine.readthedocs.io" src="https://plausible.io/js/plausible.js"></script>
    <script src="../../../_static/js/copybutton.js?v=84772c1c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user_guide/timeseries/forecasting/LagFeatures';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="WindowFeatures" href="WindowFeatures.html" />
    <link rel="prev" title="Forecasting Features" href="index.html" />
    
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>

    <!-- Cookie banner -->
    <style>
        /* Style for the cookie banner */
        #cookie-banner {
            position: fixed;
            bottom: 0;
            right: 0;
            background-color: #ffe4e1; /* Light Pink */
            color: #333;
            padding: 15px;
            max-width: 400px;
            display: none;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            z-index: 1000; /* Set a higher z-index value */
        }

        #cookie-banner p {
        font-size: 16px; /* Font size for the text */
        color: #333 !important; /* Set link color to black */
        line-height: 1.5; /* Increase line height for added spacing between sentences */
        }

        #cookie-banner a {
            color: #333;
            text-decoration: underline;
        }
    </style>

    <div id="cookie-banner">
        <h2 style="font-size: 20px; margin-bottom: 10px;">This site uses cookies</h2>
        <p style="font-size: 16px;">We use cookies to recognize your visits and preferences, to measure the effectiveness of the documentation, and discover how people find us. With your consent, you're helping us make our documentation better. <br><a href="https://www.trainindata.com/p/privacy" target="_blank">Learn More</a>.</p>
        <button id="cookie-accept">Accept</button>
        <button id="cookie-decline">Decline</button>
    </div>

    <script>
        // JavaScript to show the cookie banner and handle the accept button
        document.addEventListener('DOMContentLoaded', function () {
            var cookieBanner = document.getElementById('cookie-banner');
            var acceptButton = document.getElementById('cookie-accept');
            var declineButton = document.getElementById('cookie-decline');

            // Check if the user has already accepted or declined cookies
            var cookiesAccepted = localStorage.getItem('cookiesAccepted');

            if (!cookiesAccepted) {
                cookieBanner.style.display = 'block';

                acceptButton.addEventListener('click', function () {
                    localStorage.setItem('cookiesAccepted', 'true');
                    loadGoogleAnalytics();
                    cookieBanner.style.display = 'none';
                });

                declineButton.addEventListener('click', function () {
                    localStorage.setItem('cookiesAccepted', 'false');
                    cookieBanner.style.display = 'none';
                });
            } else if (cookiesAccepted === 'true') {
                loadGoogleAnalytics();
            }
        });

        function loadGoogleAnalytics() {
            // Load Google Analytics only if consent is given
            var script = document.createElement('script');
            script.async = true;
            script.src = 'https://www.googletagmanager.com/gtag/js?id=G-Z6MPCG673G';
            document.head.appendChild(script);

            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-Z6MPCG673G');
        }
    </script>
    <!-- Cookie banner -->


  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/sageops_logo.png" class="logo__image only-light" alt="3.1 - Home"/>
    <script>document.write(`<img src="../../../_static/sageops_logo.png" class="logo__image only-dark" alt="3.1 - Home"/>`);</script>
  
  
</a></div>
    
      <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../quickstart/index.html">
                        Quick Start
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../../index.html">
                        SageOps User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../api_doc/index.html">
                        API
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../example_notebooks/index.html">
                        Example Notebooks
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../about/index.html">
                        About
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-github-square fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../quickstart/index.html">
                        Quick Start
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../../index.html">
                        SageOps User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../api_doc/index.html">
                        API
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../example_notebooks/index.html">
                        Example Notebooks
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../about/index.html">
                        About
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fab fa-github-square fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../imputation/index.html">Experiment</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../imputation/MeanMedianImputer.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../imputation/ArbitraryNumberImputer.html">Experiment Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../imputation/EndTailImputer.html">EndTailImputer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../imputation/CategoricalImputer.html">CategoricalImputer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../imputation/RandomSampleImputer.html">RandomSampleImputer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../imputation/AddMissingIndicator.html">AddMissingIndicator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../imputation/DropMissingData.html">DropMissingData</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../encoding/index.html">Categorical Encoding</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../encoding/OneHotEncoder.html">OneHotEncoder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../encoding/OrdinalEncoder.html">Ordinal Encoding</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../encoding/CountFrequencyEncoder.html">CountFrequencyEncoder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../encoding/MeanEncoder.html">MeanEncoder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../encoding/WoEEncoder.html">Weight of Evidence (WoE)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../encoding/DecisionTreeEncoder.html">DecisionTreeEncoder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../encoding/RareLabelEncoder.html">RareLabelEncoder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../encoding/StringSimilarityEncoder.html">StringSimilarityEncoder</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../discretisation/index.html">Discretisation</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../discretisation/EqualFrequencyDiscretiser.html">EqualFrequencyDiscretiser</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../discretisation/EqualWidthDiscretiser.html">EqualWidthDiscretiser</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../discretisation/ArbitraryDiscretiser.html">ArbitraryDiscretiser</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../discretisation/DecisionTreeDiscretiser.html">DecisionTreeDiscretiser</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../discretisation/GeometricWidthDiscretiser.html">GeometricWidthDiscretiser</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../outliers/index.html">Outlier Handling</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../outliers/Winsorizer.html">Winsorizer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../outliers/ArbitraryOutlierCapper.html">ArbitraryOutlierCapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../outliers/OutlierTrimmer.html">OutlierTrimmer</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../transformation/index.html">Variance Stabilizing Transformations</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../transformation/LogTransformer.html">LogTransformer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../transformation/LogCpTransformer.html">LogCpTransformer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../transformation/ReciprocalTransformer.html">ReciprocalTransformer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../transformation/ArcsinTransformer.html">ArcsinTransformer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../transformation/PowerTransformer.html">PowerTransformer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../transformation/BoxCoxTransformer.html">BoxCoxTransformer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../transformation/YeoJohnsonTransformer.html">YeoJohnsonTransformer</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../scaling/index.html">Scaling</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../scaling/MeanNormalizationScaler.html">MeanNormalizationScaler</a></li>
</ul>
</li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../creation/index.html">Feature Creation</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../creation/CyclicalFeatures.html">CyclicalFeatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../creation/MathFeatures.html">MathFeatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../creation/RelativeFeatures.html">RelativeFeatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../creation/DecisionTreeFeatures.html">DecisionTreeFeatures</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../datetime/index.html">Datetime Features</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../datetime/DatetimeFeatures.html">DatetimeFeatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../datetime/DatetimeSubtraction.html">DatetimeSubtraction</a></li>
</ul>
</li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../selection/index.html">Feature Selection</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../selection/DropFeatures.html">DropFeatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../selection/DropConstantFeatures.html">DropConstantFeatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../selection/DropDuplicateFeatures.html">DropDuplicateFeatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../selection/DropCorrelatedFeatures.html">DropCorrelatedFeatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../selection/SmartCorrelatedSelection.html">SmartCorrelatedSelection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../selection/SelectBySingleFeaturePerformance.html">SelectBySingleFeaturePerformance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../selection/RecursiveFeatureElimination.html">RecursiveFeatureElimination</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../selection/RecursiveFeatureAddition.html">RecursiveFeatureAddition</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../selection/SelectByShuffling.html">SelectByShuffling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../selection/SelectByTargetMeanPerformance.html">SelectByTargetMeanPerformance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../selection/DropHighPSIFeatures.html">DropHighPSIFeatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../selection/SelectByInformationValue.html">SelectByInformationValue</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../selection/ProbeFeatureSelection.html">ProbeFeatureSelection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../selection/MRMR.html">MRMR - Minimum Redundancy Maximum Relevance</a></li>
</ul>
</li>
</ul>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../index.html">Time Series Features</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2 current active"><a class="reference internal" href="index.html">Forecasting Features</a></li>
</ul>
</li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../preprocessing/index.html">Preprocessing</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../preprocessing/MatchCategories.html">MatchCategories</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../preprocessing/MatchVariables.html">MatchVariables</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../wrappers/index.html">Scikit-learn Wrapper</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../wrappers/Wrapper.html">SklearnTransformerWrapper</a></li>
</ul>
</li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../pipeline/index.html">Pipeline</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-13"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../pipeline/Pipeline.html">Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pipeline/make_pipeline.html">make_pipeline</a></li>
</ul>
</li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../variable_handling/index.html">Variable handling functions</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-14"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../variable_handling/find_all_variables.html">find_all_variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../variable_handling/find_categorical_variables.html">find_categorical_variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../variable_handling/find_datetime_variables.html">find_datetime_variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../variable_handling/find_numerical_variables.html">find_numerical_variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../variable_handling/find_categorical_and_numerical_variables.html">find_categorical_and_numerical_variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../variable_handling/check_all_variables.html">check_all_variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../variable_handling/check_categorical_variables.html">check_categorical_variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../variable_handling/check_datetime_variables.html">check_datetime_variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../variable_handling/check_numerical_variables.html">check_numerical_variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../variable_handling/retain_variables_if_in_df.html">retain_variables_if_in_df</a></li>
</ul>
</li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">





<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../index.html" class="nav-link">SageOps User Guide</a></li>
    
    
    <li class="breadcrumb-item"><i class="fa-solid fa-ellipsis"></i></li>
    
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Forecasting Features</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">LagFeatures</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="lagfeatures">
<span id="lag-features"></span><h1>LagFeatures<a class="headerlink" href="#lagfeatures" title="Permalink to this heading">#</a></h1>
<p>Lag features are commonly used in data science to forecast time series with traditional</p>
<p>machine learning models, like linear regression or random forests. A lag feature is a
feature with information about a prior time step of the time series.</p>
<p>When forecasting the future values of a variable, the past values of that same variable
are likely to be predictive. Past values of other predictive features can also be useful
for our forecast. Thus, in forecasting, it is common practice to create lag features from
time series data and use them as input to machine learning algorithms or forecasting
models.</p>
<section id="what-is-a-lag-feature">
<h2>What is a lag feature?<a class="headerlink" href="#what-is-a-lag-feature" title="Permalink to this heading">#</a></h2>
<p>A lag feature is the value of the time series <strong>k</strong> period(s) in the past, where <strong>k</strong> is
the lag and is to be set by the user.  For example, a lag of 1 is a feature that contains
the previous time point value of the time series. A lag of 3 contains the value 3 time
points before, and so on. By varying k, we can create features with multiple lags.</p>
<p>In Python, we can create lag features by using the pandas method <code class="docutils literal notranslate"><span class="pre">shift</span></code>. For example, by
executing <code class="docutils literal notranslate"><span class="pre">X[my_variable].shift(freq=”1H”,</span> <span class="pre">axis=0)</span></code>, we create a new feature consisting of
lagged values of <code class="docutils literal notranslate"><span class="pre">my_variable</span></code> by 1 hour.</p>
<p>Feature-engine’s <code class="xref py py-class docutils literal notranslate"><span class="pre">LagFeatures</span></code> automates the creation of lag features from multiple
variables and by using multiple lags. It uses pandas <code class="docutils literal notranslate"><span class="pre">shift</span></code> under the hood, and automatically
concatenates the new features to the input dataframe.</p>
</section>
<section id="automating-lag-feature-creation">
<h2>Automating lag feature creation<a class="headerlink" href="#automating-lag-feature-creation" title="Permalink to this heading">#</a></h2>
<p>There are 2 ways in which we can indicate the lag k using <code class="xref py py-class docutils literal notranslate"><span class="pre">LagFeatures</span></code>. Just like
with pandas <code class="docutils literal notranslate"><span class="pre">shift</span></code>, we can indicate the lag using the parameter <code class="docutils literal notranslate"><span class="pre">periods</span></code>. This parameter
takes integers that indicate the number of rows forward that the features will be lagged.</p>
<p>Alternatively, we can use the parameter <code class="docutils literal notranslate"><span class="pre">freq</span></code>, which takes a string with the period and
frequency, and lags features based on the datetime index. For example, if we pass <code class="docutils literal notranslate"><span class="pre">freq=&quot;1D&quot;</span></code>,
the values of the features will be moved 1 day forward.</p>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">LagFeatures</span></code> transformer works very similarly to <code class="docutils literal notranslate"><span class="pre">pandas.shift</span></code>, but unlike
<code class="docutils literal notranslate"><span class="pre">pandas.shift</span></code> we can indicate the lag using either <code class="docutils literal notranslate"><span class="pre">periods</span></code> or <code class="docutils literal notranslate"><span class="pre">freq</span></code> but not both at the
same time. Also, unlike <code class="docutils literal notranslate"><span class="pre">pandas.shift</span></code>, we can only lag features forward.</p>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">LagFeatures</span></code> has several advantages over <code class="docutils literal notranslate"><span class="pre">pandas.shift</span></code>:</p>
<ul class="simple">
<li><p>First, it can create features with multiple values of k at the same time.</p></li>
<li><p>Second, it adds the features with a name to the original dataframe.</p></li>
<li><p>Third, it has the methods <code class="docutils literal notranslate"><span class="pre">fit()</span></code> and <code class="docutils literal notranslate"><span class="pre">transform()</span></code> that make it compatible with the Scikit-learn’s <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> and cross-validation functions.</p></li>
</ul>
<p>Note that, in the current implementation, <code class="xref py py-class docutils literal notranslate"><span class="pre">LagFeatures</span></code> only works with dataframes whose index,
containing the time series timestamp, contains unique values and no NaN.</p>
</section>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this heading">#</a></h2>
<p>Let’s create a toy dataset to show how to add lag features with <code class="xref py py-class docutils literal notranslate"><span class="pre">LagFeatures</span></code>.
The dataframe contains 3 numerical variables, a categorical variable, and a datetime
index. We also create an arbitrary target.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">X</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ambient_temp&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">31.31</span><span class="p">,</span> <span class="mf">31.51</span><span class="p">,</span> <span class="mf">32.15</span><span class="p">,</span> <span class="mf">32.39</span><span class="p">,</span> <span class="mf">32.62</span><span class="p">,</span> <span class="mf">32.5</span><span class="p">,</span> <span class="mf">32.52</span><span class="p">,</span> <span class="mf">32.68</span><span class="p">],</span>
     <span class="s2">&quot;module_temp&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">49.18</span><span class="p">,</span> <span class="mf">49.84</span><span class="p">,</span> <span class="mf">52.35</span><span class="p">,</span> <span class="mf">50.63</span><span class="p">,</span> <span class="mf">49.61</span><span class="p">,</span> <span class="mf">47.01</span><span class="p">,</span> <span class="mf">46.67</span><span class="p">,</span> <span class="mf">47.52</span><span class="p">],</span>
     <span class="s2">&quot;irradiation&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.51</span><span class="p">,</span> <span class="mf">0.79</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.76</span><span class="p">,</span> <span class="mf">0.42</span><span class="p">,</span> <span class="mf">0.49</span><span class="p">,</span> <span class="mf">0.57</span><span class="p">,</span> <span class="mf">0.56</span><span class="p">],</span>
     <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;green&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;blue&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span>
     <span class="p">}</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">X</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">&quot;2020-05-15 12:00:00&quot;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;15min&quot;</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
<span class="n">y</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">index</span>

<span class="n">X</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<p>Below we see the output of our toy dataframe:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>                     <span class="n">ambient_temp</span>  <span class="n">module_temp</span>  <span class="n">irradiation</span>  <span class="n">color</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">31.31</span>        <span class="mf">49.18</span>         <span class="mf">0.51</span>  <span class="n">green</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">31.51</span>        <span class="mf">49.84</span>         <span class="mf">0.79</span>  <span class="n">green</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">32.15</span>        <span class="mf">52.35</span>         <span class="mf">0.65</span>  <span class="n">green</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">32.39</span>        <span class="mf">50.63</span>         <span class="mf">0.76</span>  <span class="n">green</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">13</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">32.62</span>        <span class="mf">49.61</span>         <span class="mf">0.42</span>   <span class="n">blue</span>
</pre></div>
</div>
<p>And here we print and show the target variable:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">y</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>    <span class="mi">1</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>    <span class="mi">2</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>    <span class="mi">3</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">00</span>    <span class="mi">4</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">13</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>    <span class="mi">5</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">13</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>    <span class="mi">6</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">13</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>    <span class="mi">7</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">13</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">00</span>    <span class="mi">8</span>
<span class="n">Freq</span><span class="p">:</span> <span class="mi">15</span><span class="nb">min</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">int64</span>
</pre></div>
</div>
<section id="shift-a-row-forward">
<h3>Shift a row forward<a class="headerlink" href="#shift-a-row-forward" title="Permalink to this heading">#</a></h3>
<p>Now we will create lag features by lagging all numerical variables 1 row forward. Note
that <code class="xref py py-class docutils literal notranslate"><span class="pre">LagFeatures</span></code> automatically finds all numerical variables.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">feature_engine.timeseries.forecasting</span> <span class="kn">import</span> <span class="n">LagFeatures</span>

<span class="n">lag_f</span> <span class="o">=</span> <span class="n">LagFeatures</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">X_tr</span> <span class="o">=</span> <span class="n">lag_f</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="n">X_tr</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<p>We can find the lag features on the right side of the dataframe. Note that the values
have been shifted a row forward.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>                     <span class="n">ambient_temp</span>  <span class="n">module_temp</span>  <span class="n">irradiation</span>  <span class="n">color</span>  \
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">31.31</span>        <span class="mf">49.18</span>         <span class="mf">0.51</span>  <span class="n">green</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">31.51</span>        <span class="mf">49.84</span>         <span class="mf">0.79</span>  <span class="n">green</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">32.15</span>        <span class="mf">52.35</span>         <span class="mf">0.65</span>  <span class="n">green</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">32.39</span>        <span class="mf">50.63</span>         <span class="mf">0.76</span>  <span class="n">green</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">13</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">32.62</span>        <span class="mf">49.61</span>         <span class="mf">0.42</span>   <span class="n">blue</span>

                     <span class="n">ambient_temp_lag_1</span>  <span class="n">module_temp_lag_1</span>  <span class="n">irradiation_lag_1</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>                 <span class="n">NaN</span>                <span class="n">NaN</span>                <span class="n">NaN</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>               <span class="mf">31.31</span>              <span class="mf">49.18</span>               <span class="mf">0.51</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>               <span class="mf">31.51</span>              <span class="mf">49.84</span>               <span class="mf">0.79</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">00</span>               <span class="mf">32.15</span>              <span class="mf">52.35</span>               <span class="mf">0.65</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">13</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>               <span class="mf">32.39</span>              <span class="mf">50.63</span>               <span class="mf">0.76</span>
</pre></div>
</div>
<p>The variables to lag are stored in the <code class="docutils literal notranslate"><span class="pre">variables_</span></code> attribute of the
<code class="xref py py-class docutils literal notranslate"><span class="pre">LagFeatures</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lag_f</span><span class="o">.</span><span class="n">variables_</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;ambient_temp&#39;</span><span class="p">,</span> <span class="s1">&#39;module_temp&#39;</span><span class="p">,</span> <span class="s1">&#39;irradiation&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>We can obtain the names of the original variables plus the lag features that are the
returned in the transformed dataframe using the <code class="docutils literal notranslate"><span class="pre">get_feature_names_out()</span></code> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lag_f</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;ambient_temp&#39;</span><span class="p">,</span>
 <span class="s1">&#39;module_temp&#39;</span><span class="p">,</span>
 <span class="s1">&#39;irradiation&#39;</span><span class="p">,</span>
 <span class="s1">&#39;color&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ambient_temp_lag_1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;module_temp_lag_1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;irradiation_lag_1&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>When we create lag features, we introduce nan values for the first rows of the training
data set, because there are no past values for those data points. We can impute those
nan values with an arbitrary value as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lag_f</span> <span class="o">=</span> <span class="n">LagFeatures</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">X_tr</span> <span class="o">=</span> <span class="n">lag_f</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">X_tr</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
<p>We see that the nan values were replaced by 0:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>                     <span class="n">ambient_temp</span>  <span class="n">module_temp</span>  <span class="n">irradiation</span>  <span class="n">color</span>  \
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">31.31</span>        <span class="mf">49.18</span>         <span class="mf">0.51</span>  <span class="n">green</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">31.51</span>        <span class="mf">49.84</span>         <span class="mf">0.79</span>  <span class="n">green</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">32.15</span>        <span class="mf">52.35</span>         <span class="mf">0.65</span>  <span class="n">green</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">32.39</span>        <span class="mf">50.63</span>         <span class="mf">0.76</span>  <span class="n">green</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">13</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">32.62</span>        <span class="mf">49.61</span>         <span class="mf">0.42</span>   <span class="n">blue</span>

                     <span class="n">ambient_temp_lag_1</span>  <span class="n">module_temp_lag_1</span>  <span class="n">irradiation_lag_1</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>                <span class="mf">0.00</span>               <span class="mf">0.00</span>               <span class="mf">0.00</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>               <span class="mf">31.31</span>              <span class="mf">49.18</span>               <span class="mf">0.51</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>               <span class="mf">31.51</span>              <span class="mf">49.84</span>               <span class="mf">0.79</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">00</span>               <span class="mf">32.15</span>              <span class="mf">52.35</span>               <span class="mf">0.65</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">13</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>               <span class="mf">32.39</span>              <span class="mf">50.63</span>               <span class="mf">0.76</span>
</pre></div>
</div>
<p>Alternatively, we can drop the rows with missing values in the lag features, like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lag_f</span> <span class="o">=</span> <span class="n">LagFeatures</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">drop_na</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">X_tr</span> <span class="o">=</span> <span class="n">lag_f</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">X_tr</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>                     <span class="n">ambient_temp</span>  <span class="n">module_temp</span>  <span class="n">irradiation</span>  <span class="n">color</span>  \
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">31.51</span>        <span class="mf">49.84</span>         <span class="mf">0.79</span>  <span class="n">green</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">32.15</span>        <span class="mf">52.35</span>         <span class="mf">0.65</span>  <span class="n">green</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">32.39</span>        <span class="mf">50.63</span>         <span class="mf">0.76</span>  <span class="n">green</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">13</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">32.62</span>        <span class="mf">49.61</span>         <span class="mf">0.42</span>   <span class="n">blue</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">13</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">32.50</span>        <span class="mf">47.01</span>         <span class="mf">0.49</span>   <span class="n">blue</span>

                     <span class="n">ambient_temp_lag_1</span>  <span class="n">module_temp_lag_1</span>  <span class="n">irradiation_lag_1</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>               <span class="mf">31.31</span>              <span class="mf">49.18</span>               <span class="mf">0.51</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>               <span class="mf">31.51</span>              <span class="mf">49.84</span>               <span class="mf">0.79</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">00</span>               <span class="mf">32.15</span>              <span class="mf">52.35</span>               <span class="mf">0.65</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">13</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>               <span class="mf">32.39</span>              <span class="mf">50.63</span>               <span class="mf">0.76</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">13</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>               <span class="mf">32.62</span>              <span class="mf">49.61</span>               <span class="mf">0.42</span>
</pre></div>
</div>
<p>We can also drop the rows with nan in the lag features and then adjust the target
variable like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">X_tr</span><span class="p">,</span> <span class="n">y_tr</span> <span class="o">=</span> <span class="n">lag_f</span><span class="o">.</span><span class="n">transform_x_y</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="n">X_tr</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_tr</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
<p>We created a lag feature of 1, hence there is only 1 row with nan, which was removed from
train set and target:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">((</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mi">7</span><span class="p">,),</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">8</span><span class="p">,))</span>
</pre></div>
</div>
</section>
<section id="create-multiple-lag-features">
<h3>Create multiple lag features<a class="headerlink" href="#create-multiple-lag-features" title="Permalink to this heading">#</a></h3>
<p>We can create multiple lag features with one transformer by passing the lag periods in
a list.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lag_f</span> <span class="o">=</span> <span class="n">LagFeatures</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>

<span class="n">X_tr</span> <span class="o">=</span> <span class="n">lag_f</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="n">X_tr</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<p>Note how multiple lag features were created for each of the numerical variables and
added at the right side of the dataframe.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>                     <span class="n">ambient_temp</span>  <span class="n">module_temp</span>  <span class="n">irradiation</span>  <span class="n">color</span>  \
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">31.31</span>        <span class="mf">49.18</span>         <span class="mf">0.51</span>  <span class="n">green</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">31.51</span>        <span class="mf">49.84</span>         <span class="mf">0.79</span>  <span class="n">green</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">32.15</span>        <span class="mf">52.35</span>         <span class="mf">0.65</span>  <span class="n">green</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">32.39</span>        <span class="mf">50.63</span>         <span class="mf">0.76</span>  <span class="n">green</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">13</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">32.62</span>        <span class="mf">49.61</span>         <span class="mf">0.42</span>   <span class="n">blue</span>

                     <span class="n">ambient_temp_lag_1</span>  <span class="n">module_temp_lag_1</span>  <span class="n">irradiation_lag_1</span>  \
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>                 <span class="n">NaN</span>                <span class="n">NaN</span>                <span class="n">NaN</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>               <span class="mf">31.31</span>              <span class="mf">49.18</span>               <span class="mf">0.51</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>               <span class="mf">31.51</span>              <span class="mf">49.84</span>               <span class="mf">0.79</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">00</span>               <span class="mf">32.15</span>              <span class="mf">52.35</span>               <span class="mf">0.65</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">13</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>               <span class="mf">32.39</span>              <span class="mf">50.63</span>               <span class="mf">0.76</span>

                     <span class="n">ambient_temp_lag_2</span>  <span class="n">module_temp_lag_2</span>  <span class="n">irradiation_lag_2</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>                 <span class="n">NaN</span>                <span class="n">NaN</span>                <span class="n">NaN</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>                 <span class="n">NaN</span>                <span class="n">NaN</span>                <span class="n">NaN</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>               <span class="mf">31.31</span>              <span class="mf">49.18</span>               <span class="mf">0.51</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">00</span>               <span class="mf">31.51</span>              <span class="mf">49.84</span>               <span class="mf">0.79</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">13</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>               <span class="mf">32.15</span>              <span class="mf">52.35</span>               <span class="mf">0.65</span>
</pre></div>
</div>
<p>We can get the names of features in the resulting dataframe as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lag_f</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;ambient_temp&#39;</span><span class="p">,</span>
 <span class="s1">&#39;module_temp&#39;</span><span class="p">,</span>
 <span class="s1">&#39;irradiation&#39;</span><span class="p">,</span>
 <span class="s1">&#39;color&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ambient_temp_lag_1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;module_temp_lag_1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;irradiation_lag_1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ambient_temp_lag_2&#39;</span><span class="p">,</span>
 <span class="s1">&#39;module_temp_lag_2&#39;</span><span class="p">,</span>
 <span class="s1">&#39;irradiation_lag_2&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>We can replace the nan introduced in the lag features as well. In this opportunity,
we’ll use a string. Not that this is a suitable solution to train machine learning
algorithms, but the idea here is to showcase <code class="xref py py-class docutils literal notranslate"><span class="pre">LagFeatures</span></code>’s functionality.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lag_f</span> <span class="o">=</span> <span class="n">LagFeatures</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>

<span class="n">X_tr</span> <span class="o">=</span> <span class="n">lag_f</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">X_tr</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
<p>In this case, we replaced the nan in the lag features with the string None:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>                     <span class="n">ambient_temp</span>  <span class="n">module_temp</span>  <span class="n">irradiation</span>  <span class="n">color</span>  \
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">31.31</span>        <span class="mf">49.18</span>         <span class="mf">0.51</span>  <span class="n">green</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">31.51</span>        <span class="mf">49.84</span>         <span class="mf">0.79</span>  <span class="n">green</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">32.15</span>        <span class="mf">52.35</span>         <span class="mf">0.65</span>  <span class="n">green</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">32.39</span>        <span class="mf">50.63</span>         <span class="mf">0.76</span>  <span class="n">green</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">13</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">32.62</span>        <span class="mf">49.61</span>         <span class="mf">0.42</span>   <span class="n">blue</span>

                    <span class="n">ambient_temp_lag_1</span> <span class="n">module_temp_lag_1</span> <span class="n">irradiation_lag_1</span>  \
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>               <span class="kc">None</span>              <span class="kc">None</span>              <span class="kc">None</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>              <span class="mf">31.31</span>             <span class="mf">49.18</span>              <span class="mf">0.51</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>              <span class="mf">31.51</span>             <span class="mf">49.84</span>              <span class="mf">0.79</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">00</span>              <span class="mf">32.15</span>             <span class="mf">52.35</span>              <span class="mf">0.65</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">13</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>              <span class="mf">32.39</span>             <span class="mf">50.63</span>              <span class="mf">0.76</span>

                    <span class="n">ambient_temp_lag_2</span> <span class="n">module_temp_lag_2</span> <span class="n">irradiation_lag_2</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>               <span class="kc">None</span>              <span class="kc">None</span>              <span class="kc">None</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>               <span class="kc">None</span>              <span class="kc">None</span>              <span class="kc">None</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>              <span class="mf">31.31</span>             <span class="mf">49.18</span>              <span class="mf">0.51</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">00</span>              <span class="mf">31.51</span>             <span class="mf">49.84</span>              <span class="mf">0.79</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">13</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>              <span class="mf">32.15</span>             <span class="mf">52.35</span>              <span class="mf">0.65</span>
</pre></div>
</div>
<p>Alternatively, we can drop rows containing nan in the lag features and then adjust the
target variable:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lag_f</span> <span class="o">=</span> <span class="n">LagFeatures</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">drop_na</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">lag_f</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="n">X_tr</span><span class="p">,</span> <span class="n">y_tr</span> <span class="o">=</span> <span class="n">lag_f</span><span class="o">.</span><span class="n">transform_x_y</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="n">X_tr</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_tr</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
<p>We see that 2 rows were dropped from train set and target:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,),</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">8</span><span class="p">,))</span>
</pre></div>
</div>
</section>
<section id="lag-features-based-on-datetime">
<h3>Lag features based on datetime<a class="headerlink" href="#lag-features-based-on-datetime" title="Permalink to this heading">#</a></h3>
<p>We can also lag features utilizing information in the timestamp of the dataframe, which
is commonly cast as datetime.</p>
<p>Let’s for example create features by lagging 2 of the numerical variables 30 minutes
forward.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lag_f</span> <span class="o">=</span> <span class="n">LagFeatures</span><span class="p">(</span><span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;module_temp&quot;</span><span class="p">,</span> <span class="s2">&quot;irradiation&quot;</span><span class="p">],</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;30min&quot;</span><span class="p">)</span>

<span class="n">X_tr</span> <span class="o">=</span> <span class="n">lag_f</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="n">X_tr</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<p>Note that the features were moved forward 30 minutes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>                     <span class="n">ambient_temp</span>  <span class="n">module_temp</span>  <span class="n">irradiation</span>  <span class="n">color</span>  \
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">31.31</span>        <span class="mf">49.18</span>         <span class="mf">0.51</span>  <span class="n">green</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">31.51</span>        <span class="mf">49.84</span>         <span class="mf">0.79</span>  <span class="n">green</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">32.15</span>        <span class="mf">52.35</span>         <span class="mf">0.65</span>  <span class="n">green</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">32.39</span>        <span class="mf">50.63</span>         <span class="mf">0.76</span>  <span class="n">green</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">13</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">32.62</span>        <span class="mf">49.61</span>         <span class="mf">0.42</span>   <span class="n">blue</span>

                     <span class="n">module_temp_lag_30min</span>  <span class="n">irradiation_lag_30min</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>                    <span class="n">NaN</span>                    <span class="n">NaN</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>                    <span class="n">NaN</span>                    <span class="n">NaN</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>                  <span class="mf">49.18</span>                   <span class="mf">0.51</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">00</span>                  <span class="mf">49.84</span>                   <span class="mf">0.79</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">13</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>                  <span class="mf">52.35</span>                   <span class="mf">0.65</span>
</pre></div>
</div>
<p>We can replace the nan in the lag features with a number like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lag_f</span> <span class="o">=</span> <span class="n">LagFeatures</span><span class="p">(</span>
    <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;module_temp&quot;</span><span class="p">,</span> <span class="s2">&quot;irradiation&quot;</span><span class="p">],</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;30min&quot;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="n">X_tr</span> <span class="o">=</span> <span class="n">lag_f</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">X_tr</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
<p>Here, we replaced nan by 100:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>                     <span class="n">ambient_temp</span>  <span class="n">module_temp</span>  <span class="n">irradiation</span>  <span class="n">color</span>  \
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">31.31</span>        <span class="mf">49.18</span>         <span class="mf">0.51</span>  <span class="n">green</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">31.51</span>        <span class="mf">49.84</span>         <span class="mf">0.79</span>  <span class="n">green</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">32.15</span>        <span class="mf">52.35</span>         <span class="mf">0.65</span>  <span class="n">green</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">32.39</span>        <span class="mf">50.63</span>         <span class="mf">0.76</span>  <span class="n">green</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">13</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">32.62</span>        <span class="mf">49.61</span>         <span class="mf">0.42</span>   <span class="n">blue</span>

                     <span class="n">module_temp_lag_30min</span>  <span class="n">irradiation_lag_30min</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>                 <span class="mf">100.00</span>                 <span class="mf">100.00</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>                 <span class="mf">100.00</span>                 <span class="mf">100.00</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>                  <span class="mf">49.18</span>                   <span class="mf">0.51</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">00</span>                  <span class="mf">49.84</span>                   <span class="mf">0.79</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">13</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>                  <span class="mf">52.35</span>                   <span class="mf">0.65</span>
</pre></div>
</div>
<p>Alternatively, we can remove the nan introduced in the lag features and adjust the target:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lag_f</span> <span class="o">=</span> <span class="n">LagFeatures</span><span class="p">(</span>
    <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;module_temp&quot;</span><span class="p">,</span> <span class="s2">&quot;irradiation&quot;</span><span class="p">],</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;30min&quot;</span><span class="p">,</span> <span class="n">drop_na</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">lag_f</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="n">X_tr</span><span class="p">,</span> <span class="n">y_tr</span> <span class="o">=</span> <span class="n">lag_f</span><span class="o">.</span><span class="n">transform_x_y</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="n">X_tr</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_tr</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
<p>Two rows were removed from the training data set and the target:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,),</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">8</span><span class="p">,))</span>
</pre></div>
</div>
</section>
<section id="drop-variable-after-lagging-features">
<h3>Drop variable after lagging features<a class="headerlink" href="#drop-variable-after-lagging-features" title="Permalink to this heading">#</a></h3>
<p>Similarly, we can lag multiple time intervals forward, but this time, let’s drop the
original variable after creating the lag features.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lag_f</span> <span class="o">=</span> <span class="n">LagFeatures</span><span class="p">(</span><span class="n">variables</span><span class="o">=</span><span class="s2">&quot;irradiation&quot;</span><span class="p">,</span>
                    <span class="n">freq</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;30min&quot;</span><span class="p">,</span> <span class="s2">&quot;45min&quot;</span><span class="p">],</span>
                    <span class="n">drop_original</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span>

<span class="n">X_tr</span> <span class="o">=</span> <span class="n">lag_f</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="n">X_tr</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<p>We now see the multiple lag features at the back of the dataframe, and also that the
original variable is not present in the output dataframe.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>                     <span class="n">ambient_temp</span>  <span class="n">module_temp</span>  <span class="n">color</span>  <span class="n">irradiation_lag_30min</span>  \
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">31.31</span>        <span class="mf">49.18</span>  <span class="n">green</span>                    <span class="n">NaN</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">31.51</span>        <span class="mf">49.84</span>  <span class="n">green</span>                    <span class="n">NaN</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">32.15</span>        <span class="mf">52.35</span>  <span class="n">green</span>                   <span class="mf">0.51</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">32.39</span>        <span class="mf">50.63</span>  <span class="n">green</span>                   <span class="mf">0.79</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">13</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">32.62</span>        <span class="mf">49.61</span>   <span class="n">blue</span>                   <span class="mf">0.65</span>

                     <span class="n">irradiation_lag_45min</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>                    <span class="n">NaN</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>                    <span class="n">NaN</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>                    <span class="n">NaN</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">00</span>                   <span class="mf">0.51</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">13</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>                   <span class="mf">0.79</span>
</pre></div>
</div>
<p>This is super useful in time series forecasting, because the original variable is usually
the one that we are trying to forecast, that is, the target variable. The original variables
also contain values that are <strong>NOT</strong> available at the time points that we are forecasting.</p>
</section>
<section id="working-with-pandas-series">
<h3>Working with pandas series<a class="headerlink" href="#working-with-pandas-series" title="Permalink to this heading">#</a></h3>
<p>If your time series is a pandas Series instead of a pandas Dataframe, you need to
transform it into a dataframe before using <code class="xref py py-class docutils literal notranslate"><span class="pre">LagFeatures</span></code>.</p>
<p>The following is a pandas Series:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">[</span><span class="s1">&#39;ambient_temp&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>    <span class="mf">31.31</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>    <span class="mf">31.51</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>    <span class="mf">32.15</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">00</span>    <span class="mf">32.39</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">13</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>    <span class="mf">32.62</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">13</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>    <span class="mf">32.50</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">13</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>    <span class="mf">32.52</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">13</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">00</span>    <span class="mf">32.68</span>
<span class="n">Freq</span><span class="p">:</span> <span class="mi">15</span><span class="n">T</span><span class="p">,</span> <span class="n">Name</span><span class="p">:</span> <span class="n">ambient_temp</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</pre></div>
</div>
<p>We can use <code class="xref py py-class docutils literal notranslate"><span class="pre">LagFeatures</span></code> to create, for example, 3 features by lagging the
pandas Series if we convert it to a pandas Dataframe using the method <code class="docutils literal notranslate"><span class="pre">to_frame()</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lag_f</span> <span class="o">=</span> <span class="n">LagFeatures</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>

<span class="n">X_tr</span> <span class="o">=</span> <span class="n">lag_f</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="s1">&#39;ambient_temp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">())</span>

<span class="n">X_tr</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>                     <span class="n">ambient_temp</span>  <span class="n">ambient_temp_lag_1</span>  <span class="n">ambient_temp_lag_2</span>  \
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">31.31</span>                 <span class="n">NaN</span>                 <span class="n">NaN</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">31.51</span>               <span class="mf">31.31</span>                 <span class="n">NaN</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">32.15</span>               <span class="mf">31.51</span>               <span class="mf">31.31</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">32.39</span>               <span class="mf">32.15</span>               <span class="mf">31.51</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">13</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>         <span class="mf">32.62</span>               <span class="mf">32.39</span>               <span class="mf">32.15</span>

                     <span class="n">ambient_temp_lag_3</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>                 <span class="n">NaN</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>                 <span class="n">NaN</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>                 <span class="n">NaN</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">00</span>               <span class="mf">31.31</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">13</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>               <span class="mf">31.51</span>
</pre></div>
</div>
<p>And if we do not want the original values of time series in the returned dataframe, we
just need to remember to drop the original series after the transformation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lag_f</span> <span class="o">=</span> <span class="n">LagFeatures</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">drop_original</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">X_tr</span> <span class="o">=</span> <span class="n">lag_f</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="s1">&#39;ambient_temp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">())</span>

<span class="n">X_tr</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>                     <span class="n">ambient_temp_lag_1</span>  <span class="n">ambient_temp_lag_2</span>  \
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>                 <span class="n">NaN</span>                 <span class="n">NaN</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>               <span class="mf">31.31</span>                 <span class="n">NaN</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>               <span class="mf">31.51</span>               <span class="mf">31.31</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">00</span>               <span class="mf">32.15</span>               <span class="mf">31.51</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">13</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>               <span class="mf">32.39</span>               <span class="mf">32.15</span>

                     <span class="n">ambient_temp_lag_3</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>                 <span class="n">NaN</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">15</span><span class="p">:</span><span class="mi">00</span>                 <span class="n">NaN</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">00</span>                 <span class="n">NaN</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">12</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">00</span>               <span class="mf">31.31</span>
<span class="mi">2020</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">15</span> <span class="mi">13</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>               <span class="mf">31.51</span>
</pre></div>
</div>
</section>
<section id="getting-the-name-of-the-lag-features">
<h3>Getting the name of the lag features<a class="headerlink" href="#getting-the-name-of-the-lag-features" title="Permalink to this heading">#</a></h3>
<p>We can easily obtain the name of the original and new variables with the method
<code class="docutils literal notranslate"><span class="pre">get_feature_names_out</span></code>. By using the method with the default parameters, we obtain
all the features in the output dataframe.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lag_f</span> <span class="o">=</span> <span class="n">LagFeatures</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>

<span class="n">lag_f</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="n">lag_f</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;ambient_temp&#39;</span><span class="p">,</span>
 <span class="s1">&#39;module_temp&#39;</span><span class="p">,</span>
 <span class="s1">&#39;irradiation&#39;</span><span class="p">,</span>
 <span class="s1">&#39;color&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ambient_temp_lag_1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;module_temp_lag_1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;irradiation_lag_1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;ambient_temp_lag_2&#39;</span><span class="p">,</span>
 <span class="s1">&#39;module_temp_lag_2&#39;</span><span class="p">,</span>
 <span class="s1">&#39;irradiation_lag_2&#39;</span><span class="p">]</span>
</pre></div>
</div>
</section>
</section>
<section id="determining-the-right-lag">
<h2>Determining the right lag<a class="headerlink" href="#determining-the-right-lag" title="Permalink to this heading">#</a></h2>
<p>We can create multiple lag features by utilizing various lags. But how do we decide which
lag is a good lag?</p>
<p>There are multiple ways to do this.</p>
<p>We can create features by using multiple lags and then determine the best features by using
feature selection.</p>
<p>Alternatively, we can determine the best lag through time series analysis by evaluating
the autocorrelation or partial autocorrelation of the time series.</p>
<p>For tutorials on how to create lag features for forecasting, check the course
<a class="reference external" href="https://www.trainindata.com/p/feature-engineering-for-forecasting">Feature Engineering for Time Series Forecasting</a>.
In the course, we also show how to detect and remove outliers from time series data, how
to use features that capture seasonality and trend, and much more.</p>
</section>
<section id="lags-from-the-target-vs-lags-from-predictor-variables">
<h2>Lags from the target vs lags from predictor variables<a class="headerlink" href="#lags-from-the-target-vs-lags-from-predictor-variables" title="Permalink to this heading">#</a></h2>
<p>Very often, we want to forecast the values of just one time series. For example, we want
to forecast sales in the next month. The sales variable is our target variable, and we can
create features by lagging past sales values.</p>
<p>We could also create lag features from accompanying predictive variables. For example, if we
want to predict pollutant concentration in the next few hours, we can create lag features
from past pollutant concentrations. In addition, we can create lag features from accompanying
time series values, like the concentrations of other gases, or the temperature or humidity.</p>
</section>
<section id="see-also">
<h2>See also<a class="headerlink" href="#see-also" title="Permalink to this heading">#</a></h2>
<p>Check out the additional transformers to create window features through the use of
rolling windows (<code class="xref py py-class docutils literal notranslate"><span class="pre">WindowFeatures</span></code>) or expanding windows (<code class="xref py py-class docutils literal notranslate"><span class="pre">ExpandingWindowFeatures</span></code>).</p>
<p>If you want to use <code class="xref py py-class docutils literal notranslate"><span class="pre">LagFeatures</span></code> as part of a feature engineering pipeline,
check out Feature-engine’s <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code>.</p>
</section>
<section id="tutorials-and-courses">
<h2>Tutorials and courses<a class="headerlink" href="#tutorials-and-courses" title="Permalink to this heading">#</a></h2>
<p>For tutorials about this and other feature engineering methods for time series forecasting
check out our online courses:</p>
<figure class="align-center align-left" id="id1">
<a class="reference external image-reference" href="https://www.trainindata.com/p/feature-engineering-for-forecasting"><img alt="../../../_images/fetsf.png" src="../../../_images/fetsf.png" style="width: 300px;" /></a>
<figcaption>
<p><span class="caption-text">Feature Engineering for Time Series Forecasting</span><a class="headerlink" href="#id1" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-center align-left" id="id2">
<a class="reference external image-reference" href="https://www.courses.trainindata.com/p/forecasting-with-machine-learning"><img alt="../../../_images/fwml.png" src="../../../_images/fwml.png" style="width: 300px;" /></a>
<figcaption>
<p><span class="caption-text">Forecasting with Machine Learning</span><a class="headerlink" href="#id2" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<p>Our courses are suitable for beginners and more advanced data scientists looking to
forecast time series using traditional machine learning models, like linear regression
or gradient boosting machines.</p>
<p>By purchasing them you are supporting Sole, the main developer of Feature-engine.</p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="index.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Forecasting Features</p>
      </div>
    </a>
    <a class="right-next"
       href="WindowFeatures.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">WindowFeatures</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">

  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-a-lag-feature">What is a lag feature?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#automating-lag-feature-creation">Automating lag feature creation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#examples">Examples</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#shift-a-row-forward">Shift a row forward</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-multiple-lag-features">Create multiple lag features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lag-features-based-on-datetime">Lag features based on datetime</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#drop-variable-after-lagging-features">Drop variable after lagging features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#working-with-pandas-series">Working with pandas series</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-the-name-of-the-lag-features">Getting the name of the lag features</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#determining-the-right-lag">Determining the right lag</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lags-from-the-target-vs-lags-from-predictor-variables">Lags from the target vs lags from predictor variables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#see-also">See also</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tutorials-and-courses">Tutorials and courses</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../../../_sources/user_guide/timeseries/forecasting/LagFeatures.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.1.2.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.14.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>